<section>
  <h1>Consol Admin</h1>
  <!--  Utilisateurs localStorage  -->
  <div class="panel-group" id="accordion">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
            Utilisateurs</a>
        </h4>
      </div> 
      <div id="collapse1" class="panel-collapse collapse in ">
        <div class="panel-body">

          <table>

            <tr>
              <th>pseudo</th>
              <th>role</th>
              <th class="text-center">films Sbt</th>
              <th class="text-center">edit</th>
              <th class="text-center">delete</th>
            </tr>
            <tr *ngFor="let user of this.users; let i = index" id="accordion-films">
              <td>
                {{user.pseudo}}
              </td>
              <td>
                <div *ngIf="!isEdtUser || user !== edtUser">
                  {{user.role}}
                </div>
                <div *ngIf="isEdtUser && user === edtUser">
                  <form [formGroup]="formEdit" *ngIf="roles">
                    <select formControlName="roleControl">
                      <option *ngFor="let role of roles" [value]="role">
                        {{role}}
                      </option>
                    </select>
                  </form>
                </div>
              </td>

              <!--  films user  -->
              <td  class="text-center" >
                <div class="panel-group" id="{{'accordion-'+user.pseudo}}" *ngIf='user.totalTrue > 0'>
                  <div class="panel panel-default" *ngIf="user.carts">
                    <div class="">

                      <a data-toggle="collapse" href="{{'#collapse-'+user.pseudo}}"
                        data-parent="{{'#accordion-'+user.pseudo}}">
                        <span class="material-icons ">
                          add_circle
                        </span>
                      </a>
                    </div>
                    <div id="{{'collapse-'+user.pseudo}}" class="panel-collapse collapse in show">
                      <div class="">
                        <div *ngIf="user.carts">
                          <table class="table-film">
                            <tr>
                              <th>id</th>
                              <th>title</th>
                              
                              <th>price</th>
                              <th class="text-center">delete</th>
                            </tr>
                            <tr *ngFor="let cart of this.user.carts; let c = index">

                              
                              <td *ngIf="cart.inCart">{{cart.iddb}}</td>
                              <td *ngIf="cart.inCart">{{cart.filmdb.title}}</td>

                              <td *ngIf="cart.inCart">${{cart.prixdb}}</td>
                              <td *ngIf="cart.inCart" class="text-center">
                                <span class="material-icons delete" (click)="deleteFilmUser(user, cart)">
                                  delete
                                </span>
                              </td>


                            </tr>
                          </table>

                        </div>
                      </div>

                    </div>
                  </div>
                </div>


              </td>

              <!--  Fin Films user  -->
              <td class="text-center">
                <span class="material-icons edit " (click)="editUser(user)" *ngIf="!isEdtUser || user !== edtUser">
                  edit
                </span>
                <span class="material-icons edit " (click)="validRoleUser(user)" *ngIf="isEdtUser && user === edtUser">
                  check
                </span>
              </td > 
              <td class="text-center">
                <span class="material-icons delete" (click)="deleteUser(user)">
                  delete
                </span>
              </td>





            </tr>

          </table>
        </div>
      </div>

    </div>

    <!--  Films Spring Boot  -->




    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">
            Films Spring Boot</a>
        </h4>
      </div>
      <div class="d-flex justify-content-center mt-5 mb-2" *ngIf="!this.films">
                <div class="spinner-border text-info" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
      </div>
      <div id="collapse2" class="panel-collapse collapse in show" *ngIf="this.films">
        <div class="panel-body">
        <!-- debut form -->

        <form [formGroup]="formFilmEdit" >
          <table>
            <tr>
              <th>id</th>
              <th>title</th>
              <th>director</th>
              <th>actors</th>
              <th>date</th>
              <th>prix</th>
              <th class="text-center">edit</th>
              <th class="text-center">delete</th>
            </tr>
            <tr *ngFor="let film of films">
              <td>
                <span > <!-- *ngIf="!isEdtFilm || edtFilm !== film" -->
                  {{film.id}}
                </span>
               <!--  <span *ngIf="isEdtFilm && edtFilm === film">
                  <input type="text" formControlName="filmId" placeholder="id"> 
                </span> -->
              </td>
              <td>
                <span *ngIf="!isEdtFilm || edtFilm !== film">
                  {{film.title}}
                </span>
                <span *ngIf="isEdtFilm && edtFilm === film">
                  <input type="text" formControlName="filmTitle" placeholder="title"> 
                </span>
              </td>
              <td>
                <span *ngIf="!isEdtFilm || edtFilm !== film">
                  {{film.director.name}}
                </span>
                <span *ngIf="isEdtFilm && edtFilm === film">
                  <input type="text" formControlName="filmDirector" placeholder="director"> 
                </span>
              </td>
              <td>
                <span *ngIf="!isEdtFilm || edtFilm !== film">
                  <span *ngFor="let actor of film.actors; let virgule = index">
                    {{actor.name}}<span *ngIf="virgule !== film.actors.length - 1">, </span>
                  </span>
                </span>
                <span *ngIf="isEdtFilm && edtFilm === film">
                  <!-- <input type="text" formControlName="filmActors" placeholder="actors">  -->
                  <span class="material-icons ">
                          add_circle
                  </span>
                </span>
              </td>
              <td>
                <span *ngIf="!isEdtFilm || edtFilm !== film">
                  {{film.date}}
                </span>
                <span *ngIf="isEdtFilm && edtFilm === film">
                  <input type="text" formControlName="filmDate" placeholder="date"> 
                </span>
              </td>
              <td>
                <span *ngIf="!isEdtFilm || edtFilm !== film">
                  ${{film.prix}}
                </span>
                <span *ngIf="isEdtFilm && edtFilm === film">
                  <input type="text" formControlName="filmPrix" placeholder="prix"> 
                </span>
              </td>
                
              <td class="text-center">
                <span class="material-icons edit " (click)="editFilm(film)"  *ngIf="!isEdtFilm || edtFilm !== film">
                  edit
                </span>
                <span class="material-icons edit " (click)="valideEditFilm(film)" *ngIf="isEdtFilm && edtFilm === film"> 
                  check
                </span>
              </td>
              <td class="text-center">
                <span class="material-icons delete" (click)="deletefilm(film)">
                  delete
                </span>
              </td>

            </tr>
          </table>
        </form>


        </div>
      </div>
      </div>

    <!-- Director -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">
            Film Director</a>
        </h4>
      </div>
      <div class="d-flex justify-content-center mt-5 mb-2" *ngIf="!this.directors">
                <div class="spinner-border text-info" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
            
      </div>
      <div id="collapse3" class="panel-collapse collapse" *ngIf="this.directors">
        <div class="panel-body">
          <table>
            <tr>
              <th>id</th>
              <th>name</th>
              <th>films</th>
              <th class="text-center">edit</th>
              <th class="text-center">delete</th>
            </tr>
            <tr *ngFor="let director of this.directors">
              <td>
                {{director.id}}
              </td>
              <td>
                {{director.name}}
              </td>
              <td>


                <div class="panel-group" id="{{'accordion-'+director.id}}">
                  <div class="panel panel-default" *ngIf="director.films">
                    <div class="">

                      <a data-toggle="collapse" href="{{'#collapse-'+director.id}}"
                        data-parent="{{'#accordion-'+director.id}}">
                        <span class="material-icons ">
                          add_circle
                        </span>
                      </a>
                    </div>
                    <div id="{{'collapse-'+director.id}}" class="panel-collapse collapse in ">
                      <div class="">
                        <div *ngIf="director.films">
                          <table class="table-film">
                            <tr>
                              <th>id</th>
                              <th>title</th>
                              
                              <th>delete</th>
                            </tr>
                            <tr *ngFor="let film of director.films">
                              <td>{{film.id.id}}</td>
                              <td>{{film.title}}</td>
                             
                             
                              <td>{{film.id.date}}</td>
                              <td>
                                <span class="material-icons edit ">
                                  delete
                                </span>
                              </td>
          
                            </tr>
                          </table>

                        </div>
                      </div>

                    </div>
                  </div>
                </div>

              </td>
              <td class="text-center">
                <span class="material-icons edit ">
                  edit
                </span>
                <span class="material-icons edit ">
                  check
                </span>
              </td>
              <td class="text-center">
                <span class="material-icons delete">
                  delete
                </span>
              </td>

            </tr>
          </table>

        </div>
      </div>
    </div>

    <!--  Actor Spring Boot  -->
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4 class="panel-title">
          <a data-toggle="collapse" data-parent="#accordion" href="#collapse-Actor">
            Actor</a>
        </h4>
      </div>

      <div class="d-flex justify-content-center mt-5 mb-2" *ngIf="!this.acteurs">
                <div class="spinner-border text-info" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
      </div>
      <div id="collapse-Actor" class="panel-collapse collapse" *ngIf="this.acteurs">
        <div class="panel-body">
          <table>
            <tr>
              <th>id</th>
              <th>name</th>
              <th class="text-center">films</th>
              <th class="text-center">edit</th>
              <th class="text-center">delete</th>
            </tr>
            <tr *ngFor="let acteur of acteurs">
              <td>
                {{acteur.id}}
              </td>
              <td>
                {{acteur.name}}
              </td>
              <td class="text-center">

                <div class="panel-group" id="{{'accordion-'+acteur.id}}">
                  <div class="panel panel-default" *ngIf="acteur.films">
                    <div class="">

                      <a data-toggle="collapse" href="{{'#collapse-'+acteur.id}}"
                        data-parent="{{'#accordion-'+acteur.id}}">
                        <span class="material-icons " *ngIf="acteur.films.length > 0">
                          add_circle
                        </span>
                      </a>
                    </div>
                    <div id="{{'collapse-'+acteur.id}}" class="panel-collapse collapse in ">
                      <div class="">
                        <div *ngIf="acteur.films">
                          <table class="table-film">
                            <tr>
                              <th>id</th>
                              <th>title</th>
                              
                              <th>date</th>
                              <th class="text-center">delete</th>
                            </tr>
                            <tr *ngFor="let film of acteur.films">
                              <td>{{film.id}}</td>
                              <td>{{film.title}}</td>
                              
                             
                              <td>{{film.date}}</td>
                              <td>
                                <span class="material-icons edit ">
                                  delete
                                </span>
                              </td>
          
                            </tr>
                          </table>

                        </div>
                      </div>

                    </div>
                  </div>
                </div>
              </td>
              <td class="text-center">
                <span class="material-icons edit ">
                  edit
                </span>
                <span class="material-icons edit ">
                  check
                </span>
              </td>
              <td class="text-center">
                <span class="material-icons delete">
                  delete
                </span>
              </td>

            </tr>
          </table>

        </div>
      </div>
    </div>
  </div>
</section>
